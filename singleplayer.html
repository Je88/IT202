<!DOCTYPE html>
<!-- Hunted Game, edited from Collect The Square game -->
<html>
<head>

<style>
.button {
  background-color: #4CAF50;
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
}
#contents {
margin-left: auto;
margin-right: auto;
}
div{
  display: none;
}
div.relative {
  position: relative;
  left: 50px;
  bottom: 200px;
}
</style>

<script>
// Get a reference to the canvas DOM element
var canvas;
// Get the canvas drawing context
var context;
// Your score
var score = 0;
// Properties for your square
var x = 50; // X position
var y = 100; // Y position
var speed = 2; // Distance to move each frame
var sideLength = 20; // Length of each side of the square
// Properties for your AI Hunter
var aiX = 400; // X position
var aiY = 400; // Y position
var aiSpeed = 1.5; // Distance to move each frame
var aiLength = 25; // Length of each side of the square
// Flags to track which keys are pressed
var down = false;
var up = false;
var right = false;
var left = false;
// Properties for the target circle
var targetX = 0;
var targetY = 0;
var targetLength = 5;
// PROPERTIES FOR POWER UP
var pupX = 0;
var pupY = 0;
var pupLength = 20;
//CountdownTimer
var countdown = 90;
var countup = 0;

// ID to track the setTimeout
var id = null;
var t = 1, ais = 1;
// Determine if number a is within the range b to c (exclusive)
function isWithin(a, b, c) {
  return (a > b && a < c);
}

// runs on page load
function init() {
  canvas =  document.getElementById("board");
  context = canvas.getContext("2d");
  canvas.focus();
  startGame();
}
// Listen for keydown events
window.addEventListener('keydown', function(event) {
  event.preventDefault();
  console.log(event.key, event.keyCode);
  if (event.keyCode === 40) { // DOWN
    down = true;
  }
  if (event.keyCode === 38) { // UP
    up = true;
  }
  if (event.keyCode === 37) { // LEFT
    left = true;
  }
  if (event.keyCode === 39) { // RIGHT
    right = true;
  }
});
// Listen for keyup events
window.addEventListener('keyup', function(event) {
  event.preventDefault();
  console.log(event.key, event.keyCode);
  if (event.keyCode === 40) { // DOWN
    down = false;
  }
  if (event.keyCode === 38) { // UP
    up = false;
  }
  if (event.keyCode === 37) { // LEFT
    left = false;
  }
  if (event.keyCode === 39) { // RIGHT
    right = false;
  }
});
// Start the game
function startGame() {
  //Reduce timer every second
  id = setInterval(function() {
	countdown--;
  }, 1000)
  //increase timer every second
  id = setInterval(function() {
	countup++;
  }, 1000)

  // Stop listening for click events
  window.removeEventListener('click', startGame);
  // Put the target at a random starting point
	moveTarget();
  movePowerUp();
  //click = 0;
  // Kick off the draw loop
  draw();
}

//increase player & ai speed every 15 seconds
//setInterval(function(){t++;}, 15000);
//setInterval(function(){ais++}, 20000);
//setInterval(function(){alert("You Just made it another MINUTE Congrats");}, 60000);
//increasing players speed
//  if(countup > 15 * t){
//      speed += speed + t;
//}
//increasing ai speed                                                                                                            
//  if(countup > 20 * t){                                                                                                      
//      aispeed += speed + (interval/2);
//  }


// Show the game over screen
function endGame() {
  // Display the final score
  erase();
  context.fillStyle = '#000000';
  context.font = '24px Arial';
  context.textAlign = 'center';
  context.fillText('Final Score: ' + score, canvas.width / 2, canvas.height / 6);
   
}
// Move the target square to a random position
function moveTarget() {
  targetX = Math.round(Math.random() * canvas.width - targetLength);
  targetY = Math.round(Math.random() * canvas.height - targetLength)
}
// MOVE POWERUP SOMEWHERE, BUT NOT ALL THE TIME
function movePowerUp() {
  // IF RANDOM SEED IS GREATER THAN OTHER SEED, PRODUCE POWER UP
  pupX = Math.round(Math.random() * canvas.width - pupLength);
  pupY = Math.round(Math.random() * canvas.height - pupLength);
}
// Clear the canvas
function erase() {
  context.fillStyle = '#FFFFFF';
  context.fillRect(0, 0, 600, 600);
}
// The main draw loop
function draw() {
  erase();
  // Move the square
  if (down) {
    y += speed;
  }
  if (up) {
    y -= speed;
  }
  if (right) {
    x += speed;
  }
  if (left) {
    x -= speed;
  }
//Keeps in Bounds
  if (y + sideLength > canvas.height) {
    y = canvas.height - sideLength;
  }
  if (y < 0) {
    y = 0;
  }
  if (x < 0) {
    x = 0;
  }
  if (x + sideLength > canvas.width) {
    x = canvas.width - sideLength;
  }
  //Move AI
  if(x != aiX && y != aiY){
    if(x >= aiX){
      aiX += 1;
    }
    else{   
      aiX -= 1;
    }

    if(y < aiY){
      aiY -= 1;
    }
    else{                                                                                                            
      aiY += 1;
    }     
  }

  // Collide with the target
  if (isWithin(targetX, x, x + sideLength) || isWithin(targetX + targetLength, x, x + sideLength)) { // X
    if (isWithin(targetY, y, y + sideLength) || isWithin(targetY + targetLength, y, y + sideLength)) { // Y
      // Respawn the target
      moveTarget();
      // Increase the score
      score++;
    }
  }
  // COLLIDE WITH POWER UP
  if (isWithin(pupX, x, x + pupLength) || isWithin(pupX + pupLength, x, x + pupLength)) { // X
    if (isWithin(pupY, y, y + pupLength) || isWithin(pupY + pupLength, y, y + pupLength)) { // Y
      // Respawn the power up, else don't show it
      rand = Math.random();
      rand2 = Math.random();
      if (rand > rand2) {
        movePowerUp();
      }
      else {
      // Do power up things
      sideLength+= 1;
    }
  }
}
  // Draw the player
  context.fillStyle = '#FF0000';
  context.fillRect(x, y, sideLength, sideLength);
  // Draw the Ai
  context.fillStyle = '#000000';
  context.fillRect(aiX, aiY, aiLength, aiLength);
  // Draw the target 
  // BLUE CIRCLE POINT
  context.fillStyle = '#00FF00';
  var radius = 10;
  context.beginPath();
  context.arc(targetX, targetY, radius, 0, 2 * Math.PI);
  context.closePath();
  context.fill();
  // DRAW THE POWER-UP
  context.fillStyle = '#FFFF00';
  context.fillRect(pupX, pupY, pupLength, pupLength);
  // Draw the score & time remaining
  context.fillStyle = '#000000';
  context.font = '24px Arial';
  context.textAlign = 'left';
  context.fillText('Score: ' + score, 10, 24);
  context.fillText('Time Remaining: ' + countdown, 10, 50);
  
  // 
  if(countdown <= 0 || ((isWithin(aiX, x, x + aiLength) || isWithin(aiX + aiLength, x, x + aiLength)) && (isWithin(aiY, y, y + aiLength) || isWithin(aiY + aiLength, y, y + aiLength)))){
    endGame();
  
    /*$score = score;
    require("config.php");
    $conn_string = "mysql:host=$host;dbname=$database;charset=utf8mb4";
   
    try{
      $db = new PDO($conn_string, $username, $password);
      $upscore = $db->prepare("update Score FROM `SignUp` WHERE username = :username LIMIT 1");
      $upscore->execute(array(":score"=> $score));
      $results = $upscore->fetch(PDO::FETCH_ASSOC);
    }
    catch(Exception $e){
    echo $e->getMessage();
    }*/
  
    //if(Get[UserHighScore] < score){
    //UserHighScore = score;
    //}
  
    //Makes hidden div buttons visible
    var b = document.getElementById("AgainOrEnd");                                 
    if (b.style.display = "none") {
      b.style.display = "block";
    }
  }
  else {
    window.requestAnimationFrame(draw);
  }
}
</script>
  

  </head>

<body onload="init();">
  <main>
    <canvas id="board" width="600px" height="600px" style="border: 1px solid black;"></canvas>
  </main>
        <div id="AgainOrEnd" class="relative" style="text-align:center;width:480px;">
        <a href="singleplayer.html" class ="button">Play Again</a>
        <a href="gamepage.php" class ="button">Go Home</a>
        </div>
  
</body>
</html>
